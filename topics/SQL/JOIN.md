## Виды JOIN. Пример в PostgreSQL

Попробуем на примере двух маленьких таблиц посчитать, сколько (и каких) строк получится при каждом из видов джойнов.

### Создание таблиц
Для этого мы создадим две маленькие таблицы t1 и t2. В каждой таблице - по одной колонке. В t1 - колонка a, в t2 - колонка b.


    CREATE TABLE t1 (
    a INTEGER
    );
    
    CREATE TABLE t2 (
    b INTEGER
    );

Теперь наполним их данными:
    
    INSERT INTO t1(a) VALUES(1);
    INSERT INTO t1(a) VALUES(2);
    INSERT INTO t1(a) VALUES(3);
    INSERT INTO t1(a) VALUES(4);
    INSERT INTO t1(a) VALUES(5);
    INSERT INTO t1(a) VALUES(6);
    INSERT INTO t1(a) VALUES(7);
    INSERT INTO t1(a) VALUES(NULL);
    
    INSERT INTO t2(b) VALUES(1);
    INSERT INTO t2(b) VALUES(1);
    INSERT INTO t2(b) VALUES(2);
    INSERT INTO t2(b) VALUES(2);
    INSERT INTO t2(b) VALUES(5);
    INSERT INTO t2(b) VALUES(9);
    INSERT INTO t2(b) VALUES(NULL);
    INSERT INTO t2(b) VALUES(NULL);

Посмотрим, как они выглядят, для наглядности поставим их рядом: 

    
| a |  | b |
| :--------------------: | :--------------------: | :--------------------: |
| 1 |      | 1 |
| 2 |      | 1 |
| 3 |      | 2 |
| 4 |      | 2 |
| 5 |      | 5 |
| 6 |      | 9 |
| 7 |      | NULL |
| NULL |      | NULL |

### INNER JOIN

    SELECT t1.a, t2.b
    FROM t1
    INNER JOIN t2 ON t1.a=t2.b

**Вопрос:** Сколько будет строк при этом виде джойна? И каких? Что с NULL и почему?

| a |  | b |
| :--------------------: | :--------------------: | :--------------------: |
| 1 |      | 1 |
| 2 |      | 1 |
| 3 |      | 2 |
| 4 |      | 2 |
| 5 |      | 5 |
| 6 |      | 9 |
| 7 |      | NULL |
| NULL |      | NULL |

**Ответ:**

| a |  | b |
| :--------------------: | :--------------------: | :--------------------: |
| 1 |      | 1 |
| 1 |      | 1 |
| 2 |      | 2 |
| 2 |      | 2 |
| 5 |      | 5 |
    
- джойн ходит по каждой строчке, поэтому для единицы из t1.a присоединяется каждая из единиц из t2.b. Аналогично и для двойки из t1.a - присоединяется каждая двойка из t2.b.

- NULL не равен самому себе и ничему другому, поэтому при INNER JOIN NULL ни с чем не соединился. Как итог строки с NULL в результате нет.

### LEFT JOIN

    SELECT t1.a, t2.b
    FROM t1
    LEFT JOIN t2 ON t1.a=t2.b

**Вопрос:** Сколько будет строк при этом виде джойна? И каких? Что с NULL и почему?

| a |  | b |
| :--------------------: | :--------------------: | :--------------------: |
| 1 |      | 1 |
| 2 |      | 1 |
| 3 |      | 2 |
| 4 |      | 2 |
| 5 |      | 5 |
| 6 |      | 9 |
| 7 |      | NULL |
| NULL |      | NULL |

**Ответ:**


| a |  | b |
| :--------------------: | :--------------------: | :--------------------: |
| 1 |      | 1 |
| 1 |      | 1 |
| 2 |      | 2 |
| 2 |      | 2 |
| 3 |      | NULL |
| 4 |      | NULL |
| 5 |      | 5 |
| 6 |      | NULL |
| 7 |      | NULL |
| NULL |      | NULL |

- хотя кажется, что левая таблица взята за основу и её можно просто скопировать, это не так. Количество строк в левой таблице при LEFT JOIN может измениться в бОльшую сторону. Как мы помним, джойн ходит по **каждой** строке и проверяет строки на равенство. Поэтому для единицы из левой таблицы равны оказались и первая, и вторая единица из второй таблицы. В итоге для одной единицы из левой таблицы в результате получилось две строки.

- NULL не равен самому себе. Но в данном случае строка с NULL в результате есть. Просто потому что в LEFT JOIN в результате должны остаться все строки из левой таблицы (и с NULL тоже). К нему добавился новый NULL от отсутствия результата, а не от равенства с каким-либо из имевшихся NULL в правой таблице.

### RIGHT JOIN

    SELECT t1.a, t2.b
    FROM t1
    RIGHT JOIN t2 ON t1.a=t2.b

**Вопрос:** Сколько будет строк при этом виде джойна? И каких? Что с NULL и почему?

| a |  | b |
| :--------------------: | :--------------------: | :--------------------: |
| 1 |      | 1 |
| 2 |      | 1 |
| 3 |      | 2 |
| 4 |      | 2 |
| 5 |      | 5 |
| 6 |      | 9 |
| 7 |      | NULL |
| NULL |      | NULL |

**Ответ:**


| a |  | b |
| :--------------------: | :--------------------: | :--------------------: |
| 1 |      | 1 |
| 1 |      | 1 |
| 2 |      | 2 |
| 2 |      | 2 |
| 5 |      | 5 |
| NULL |      | 9 |
| NULL |      | NULL |
| NULL |      | NULL |

- здесь зеркальная ситуация, а  целом логика такая же, как у LEFT JOIN. Джойн ходит по каждой строке и проверяет равенство. Поэтому снова по две строки для единиц и двоек.

- в итоговой таблице оба имевшихся NULL из правой таблицы.

### FULL OUTER JOIN

    SELECT t1.a, t2.b
    FROM t1
    FULL JOIN t2 ON t1.a=t2.b

**Вопрос:** Сколько будет строк при этом виде джойна? И каких? Что с NULL и почему?

| a |  | b |
| :--------------------: | :--------------------: | :--------------------: |
| 1 |      | 1 |
| 2 |      | 1 |
| 3 |      | 2 |
| 4 |      | 2 |
| 5 |      | 5 |
| 6 |      | 9 |
| 7 |      | NULL |
| NULL |      | NULL |

**Ответ:**

| a |  | b |
| :--------------------: | :--------------------: | :--------------------: |
| 1 |      | 1 |
| 1 |      | 1 |
| 2 |      | 2 |
| 2 |      | 2 |
| 3 |      | NULL |
| 4 |      | NULL |
| 5 |      | 5 |
| 6 |      | NULL |
| 7 |      | NULL |
| NULL |      | NULL |
| NULL |      | 9 |
| NULL |      | NULL |
| NULL |      | NULL |

- должны остаться все строки и из левой, и из правой таблицы. Поскольку NULL не равен NULL, остаётся и строка с NULL из левой таблицы, и две строки с NULL из правой таблицы.

- а где соответствия нет (для значений 3, 4 из левой таблицы и 9 из правой) - появляются новые NULL.
